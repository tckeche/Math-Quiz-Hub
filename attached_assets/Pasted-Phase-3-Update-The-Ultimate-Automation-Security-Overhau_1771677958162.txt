Phase 3 Update: The Ultimate Automation & Security Overhaul

Please implement the following advanced features into our full-stack application (React, Express, Postgres via Drizzle). Do not break existing features.

1. Quiz Security (The PIN System):

Update the Quizzes database schema to include a pin_code (string, 5 random alphanumeric characters).

Generate this PIN automatically on the backend when the admin creates a new quiz and display it clearly on the Admin Quiz Details page.

Update the Student Entry Gate (/quiz/:quiz_id): Add a required input field for the "Quiz PIN". The backend MUST verify that the PIN matches the quiz_id before returning the questions or starting the timer.

2. The AI Co-Pilot Chat Interface (Admin /admin/builder):

Build a split-screen UI for creating quizzes.

Left Pane (Chat): A ChatGPT-style chat interface using the Gemini API (gemini-2.5-flash). The system prompt must instruct the AI to act as a curriculum assistant. When the admin asks for questions, the AI must respond with conversational text AND a strict JSON block of questions matching the database schema (using double-escaped LaTeX for math).

Right Pane (Staging Area): The frontend must intercept the JSON from the AI's response and render it in a "Drafts" view. Here, the admin can edit the text, assign marks_worth, and use a file upload button to attach necessary image diagrams to specific questions before clicking "Save & Publish" to the database.

3. Macro-Analytics & PDF Export (/admin/analytics/:quiz_id):

Class AI Analysis: Create an endpoint (POST /api/analyze-class) that gathers all Submissions for a specific quiz. Send this bulk data to the Gemini API with the prompt: "You are a master mathematics tutor. Analyze this cohort's quiz data. Identify macro-trends, the most commonly failed questions, and the specific mathematical concepts the class as a whole is struggling with. Output in clean, professional HTML."

PDF Export: Install react-to-print (or a similar lightweight client-side PDF library). Add a prominent "Download Report as PDF" button that takes the rendered AI HTML report (both for individual students and the whole class) and saves it as a stylized PDF file to the admin's local machine.